
$ python3 colbert/tests/mmap_test.py --target_dir=./experiments/mmap_test --test_iter=1 --coalesce
n3 colbert/tests/mmap_test.py --target_dir=./experiments/mmap_test --test_iter=1 --coalesce

Starting MMap stress test with coalescing set to True, 354 residuals, and 100 compute cycles

Starting random file read control test from /lfs/0/udingank/msmarco.nbits-2.latest
Starting iteration 0
reading file /lfs/0/udingank/msmarco.nbits-2.latest/0.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/100.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/200.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/300.residuals.pt
computation cycle 0
computation cycle 10
computation cycle 20
computation cycle 30
computation cycle 40
computation cycle 50
computation cycle 60
computation cycle 70
computation cycle 80
computation cycle 90

Starting random file read mmap test from /lfs/0/udingank/msmarco.nbits-2.latest
Starting iteration 0
reading file /lfs/0/udingank/msmarco.nbits-2.latest/0.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/100.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/200.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/300.residuals.pt
computation cycle 0
computation cycle 10
computation cycle 20
computation cycle 30
computation cycle 40
computation cycle 50
computation cycle 60
computation cycle 70
computation cycle 80
computation cycle 90

Saving Results
--------------
Results saved to ./experiments/mmap_test/results-ssd-coalesce.png

control_basic: 19.13605 GB
mmap_basic: 19.16613 GB
control_compute: 19.14527 GB
mmap_compute: 19.13736 GB

Timing Summary
--------------

  Timing              |  Control (ms)  |  MMap (ms)
  ----------------------|----------------|--------------
   initial load         | 14469          |  1641
    copy + compute avg   | 0.54          |  0.74
     total copy + compute | 2031          |  2518

     Starting random file read control test from /lfs/1/udingank/msmarco.nbits-2.latest
     Starting iteration 0
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/0.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/100.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/200.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/300.residuals.pt
     computation cycle 0
     computation cycle 10
     computation cycle 20
     computation cycle 30
     computation cycle 40
     computation cycle 50
     computation cycle 60
     computation cycle 70
     computation cycle 80
     computation cycle 90

     Starting random file read mmap test from /lfs/1/udingank/msmarco.nbits-2.latest
     Starting iteration 0
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/0.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/100.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/200.residuals.pt
     reading file /lfs/1/udingank/msmarco.nbits-2.latest/300.residuals.pt
     computation cycle 0
     computation cycle 10
     computation cycle 20
     computation cycle 30
     computation cycle 40
     computation cycle 50
     computation cycle 60
     computation cycle 70
     computation cycle 80
     computation cycle 90

     Saving Results
     --------------
     Results saved to ./experiments/mmap_test/results-hdd-coalesce.png

     control_basic: 19.13537 GB
     mmap_basic: 19.16498 GB
     control_compute: 19.14513 GB
     mmap_compute: 19.13624 GB

     Timing Summary
     --------------

       Timing              |  Control (ms)  |  MMap (ms)
       ----------------------|----------------|--------------
        initial load         | 15164          |  1783
         copy + compute avg   | 1.08          |  0.87
          total copy + compute | 2445          |  2302

          Finished MMap stress test

Starting MMap stress test with coalescing set to True, 354 residuals, and 100 compute cycles

Starting random file read control test from /lfs/0/udingank/msmarco.nbits-2.latest
Starting iteration 0
reading file /lfs/0/udingank/msmarco.nbits-2.latest/0.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/100.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/200.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/300.residuals.pt
computation cycle 0
computation cycle 10
computation cycle 20
computation cycle 30
computation cycle 40
computation cycle 50
computation cycle 60
computation cycle 70
computation cycle 80
computation cycle 90

Starting random file read mmap test from /lfs/0/udingank/msmarco.nbits-2.latest
Starting iteration 0
reading file /lfs/0/udingank/msmarco.nbits-2.latest/0.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/100.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/200.residuals.pt
reading file /lfs/0/udingank/msmarco.nbits-2.latest/300.residuals.pt
computation cycle 0
computation cycle 10
computation cycle 20
computation cycle 30
computation cycle 40
computation cycle 50
computation cycle 60
computation cycle 70
computation cycle 80
computation cycle 90

Saving Results
--------------
Results saved to ./experiments/mmap_test/results-ssd.png

control_basic: 19.13820 GB
mmap_basic: 19.16721 GB
control_compute: 38.27598 GB
mmap_compute: 38.27320 GB

Timing Summary
--------------

  Timing   |  Control  |  MMap
  -----------|-----------|--------------
   read time | 14.76269  |  1.88503
    copy time | 1.17140  |  1.15340
      compute  | 0.00360  |  0.00306
         total   | 242.67983  |  241.50607

         Starting random file read control test from /lfs/1/udingank/msmarco.nbits-2.latest
         Starting iteration 0
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/0.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/100.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/200.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/300.residuals.pt
         computation cycle 0
         computation cycle 10
         computation cycle 20
         computation cycle 30
         computation cycle 40
         computation cycle 50
         computation cycle 60
         computation cycle 70
         computation cycle 80
         computation cycle 90

         Starting random file read mmap test from /lfs/1/udingank/msmarco.nbits-2.latest
         Starting iteration 0
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/0.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/100.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/200.residuals.pt
         reading file /lfs/1/udingank/msmarco.nbits-2.latest/300.residuals.pt
         computation cycle 0
         computation cycle 10
         computation cycle 20
         computation cycle 30
         computation cycle 40
         computation cycle 50
         computation cycle 60
         computation cycle 70
         computation cycle 80
         computation cycle 90

         Saving Results
         --------------
         Results saved to ./experiments/mmap_test/results-hdd.png

         control_basic: 19.13613 GB
         mmap_basic: 19.16541 GB
         control_compute: 38.27438 GB
         mmap_compute: 38.27160 GB

         Timing Summary
         --------------

           Timing   |  Control  |  MMap
           -----------|-----------|--------------
            read time | 14.78409  |  1.82461
             copy time | 1.23404  |  1.14321
               compute  | 0.00624  |  0.00409
                  total   | 251.16945  |  240.13128
